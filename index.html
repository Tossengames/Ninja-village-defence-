<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Stealth Game</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <canvas id="game"></canvas>
    
    <!-- Mission Log (Top Left) - Hidden by default -->
    <div id="missionLog" class="hidden"></div>
    
    <!-- UI Controls (Top Right) -->
    <div id="ui-controls" class="hidden">
        <button id="mapToggle" onclick="toggleMinimap()">Toggle Map</button>
    </div>
    
    <!-- Fixed Status Circle (Left of toolbar) -->
    <div id="playerStatus" class="status-circle stealth hidden">
        <div class="status-emoji">ü•∑</div>
        <div class="status-glow"></div>
    </div>
    
    <!-- Toolbar (Bottom Center) - FIXED POSITION -->
    <div id="toolbar" class="hidden">
        <div class="tool-btn" id="btnMove" onclick="setMode('move')">
            <span>üë£</span>
            Move
        </div>
        <div class="tool-btn" id="btnAttack" onclick="setMode('attack')">
            <span>‚öîÔ∏è</span>
            Attack
        </div>
        <div class="tool-btn" id="btnTrap" onclick="setMode('trap')">
            <span>‚ö†Ô∏è</span>
            Trap
            <div class="tool-count" id="trapCount">0</div>
        </div>
        <div class="tool-btn" id="btnRice" onclick="setMode('rice')">
            <span>üçö</span>
            Rice
            <div class="tool-count" id="riceCount">0</div>
        </div>
        <div class="tool-btn" id="btnBomb" onclick="setMode('bomb')">
            <span>üí£</span>
            Bomb
            <div class="tool-count" id="bombCount">0</div>
        </div>
        <div class="tool-btn" id="btnGas" onclick="setMode('gas')">
            <span>üí®</span>
            Gas
            <div class="tool-count" id="gasCount">0</div>
        </div>
        <div class="tool-btn" onclick="playerWait()">
            <span>‚è≥</span>
            Wait
        </div>
    </div>
    
    <!-- Main Menu -->
    <div id="menu" class="overlay-screen">
        <div class="menu-box">
            <h1>STEALTH GAME</h1>
            
            <!-- Map Size Selection -->
            <div class="menu-item">
                <label>Map Size:</label>
                <div class="number-selector">
                    <button class="num-btn" onclick="changeMapSize(-1)">‚óÄ</button>
                    <span id="mapSizeValue" class="num-value">12</span>
                    <button class="num-btn" onclick="changeMapSize(1)">‚ñ∂</button>
                </div>
            </div>
            
            <!-- Guard Count Selection -->
            <div class="menu-item">
                <label>Guard Count:</label>
                <div class="number-selector">
                    <button class="num-btn" onclick="changeGuardCount(-1)">‚óÄ</button>
                    <span id="guardCountValue" class="num-value">5</span>
                    <button class="num-btn" onclick="changeGuardCount(1)">‚ñ∂</button>
                </div>
            </div>
            
            <!-- Item Selection Grid -->
            <div class="item-selection">
                <h3>SELECT ITEMS (Max: 3 types, 5 items total)</h3>
                <div class="item-grid">
                    <!-- Row 1 -->
                    <div class="item-btn" data-type="trap" onclick="toggleItem('trap')">
                        <div class="item-icon">‚ö†Ô∏è</div>
                        <div class="item-name">Trap</div>
                        <div class="item-count" id="trapSelCount">0</div>
                    </div>
                    <div class="item-btn" data-type="rice" onclick="toggleItem('rice')">
                        <div class="item-icon">üçö</div>
                        <div class="item-name">Rice</div>
                        <div class="item-count" id="riceSelCount">0</div>
                    </div>
                    <div class="item-btn" data-type="bomb" onclick="toggleItem('bomb')">
                        <div class="item-icon">üí£</div>
                        <div class="item-name">Bomb</div>
                        <div class="item-count" id="bombSelCount">0</div>
                    </div>
                    <div class="item-btn" data-type="gas" onclick="toggleItem('gas')">
                        <div class="item-icon">üí®</div>
                        <div class="item-name">Gas</div>
                        <div class="item-count" id="gasSelCount">0</div>
                    </div>
                    
                    <!-- Row 2 -->
                    <div class="item-btn" data-type="health" onclick="toggleItem('health')">
                        <div class="item-icon">‚ù§Ô∏è</div>
                        <div class="item-name">Heal</div>
                        <div class="item-count" id="healthSelCount">0</div>
                    </div>
                    <div class="item-btn" data-type="coin" onclick="toggleItem('coin')">
                        <div class="item-icon">üí∞</div>
                        <div class="item-name">Coin</div>
                        <div class="item-count" id="coinSelCount">0</div>
                    </div>
                    <div class="item-btn" data-type="sight" onclick="toggleItem('sight')">
                        <div class="item-icon">üëÅÔ∏è</div>
                        <div class="item-name">Sight</div>
                        <div class="item-count" id="sightSelCount">0</div>
                    </div>
                    <div class="item-btn" data-type="mark" onclick="toggleItem('mark')">
                        <div class="item-icon">üéØ</div>
                        <div class="item-name">Mark</div>
                        <div class="item-count" id="markSelCount">0</div>
                    </div>
                </div>
                
                <div class="selection-stats">
                    Selected: <span id="totalItems">0</span>/5 items, 
                    <span id="totalTypes">0</span>/3 types
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="menu-actions">
                <button class="menu-action-btn" onclick="showTutorial()">HOW TO PLAY</button>
                <button class="start-btn" onclick="startGame()">START MISSION</button>
            </div>
        </div>
    </div>
    
    <!-- Tutorial Screen -->
    <div id="tutorialScreen" class="overlay-screen hidden">
        <div class="tutorial-box">
            <h1>HOW TO PLAY</h1>
            
            <div class="tutorial-content">
                <div class="tutorial-section">
                    <h2>üéÆ CONTROLS</h2>
                    <p>‚Ä¢ <strong>Click/Tap</strong> on highlighted tiles to move, attack, or use items</p>
                    <p>‚Ä¢ <strong>Drag</strong> to pan the camera around the map</p>
                    <p>‚Ä¢ <strong>Pinch/Pull</strong> to zoom in and out</p>
                </div>
                
                <div class="tutorial-section">
                    <h2>üïµÔ∏è STEALTH MECHANICS</h2>
                    <p>‚Ä¢ Move up to <strong>3 tiles</strong> per turn</p>
                    <p>‚Ä¢ Hide in <strong>shadow tiles</strong> to become invisible to enemies</p>
                    <p>‚Ä¢ Enemies have <strong>60¬∞ cone vision</strong> - stay out of their line of sight</p>
                    <p>‚Ä¢ <strong>Stealth kills</strong> are instant if enemy can't see you</p>
                </div>
                
                <div class="tutorial-section">
                    <h2>‚öîÔ∏è COMBAT</h2>
                    <p>‚Ä¢ <strong>Normal attacks</strong> trigger combat if enemy can see you</p>
                    <p>‚Ä¢ <strong>Stealth kills</strong> don't trigger combat (instant kill)</p>
                    <p>‚Ä¢ <strong>Sleeping enemies</strong> can be instantly killed</p>
                    <p>‚Ä¢ When spotted, enemies will chase you for several turns</p>
                </div>
                
                <div class="tutorial-section">
                    <h2>üéØ ITEMS</h2>
                    <p>‚Ä¢ <strong>‚ö†Ô∏è Trap</strong>: Instantly kills enemies that step on it</p>
                    <p>‚Ä¢ <strong>üçö Rice</strong>: Enemies will eat it and die after a few turns</p>
                    <p>‚Ä¢ <strong>üí£ Bomb</strong>: Explodes after 3 turns, damages nearby enemies</p>
                    <p>‚Ä¢ <strong>üí® Gas</strong>: Puts enemies to sleep for several turns</p>
                    <p>‚Ä¢ <strong>‚ù§Ô∏è Heal</strong>: Restores 3 HP (if implemented)</p>
                    <p>‚Ä¢ <strong>üí∞ Coin</strong>: Bonus points if collected (if implemented)</p>
                </div>
                
                <div class="tutorial-section">
                    <h2>üèÜ SCORING</h2>
                    <p>‚Ä¢ <strong>Stealth kills</strong> give bonus points</p>
                    <p>‚Ä¢ <strong>Time bonus</strong>: Faster completion = more points</p>
                    <p>‚Ä¢ <strong>Penalty</strong>: Getting spotted reduces score</p>
                    <p>‚Ä¢ <strong>Ranks</strong>: Grand Master, Master Ninja, Assassin, Shinobi, Ronin, Thug</p>
                </div>
            </div>
            
            <button class="back-btn" onclick="hideTutorial()">BACK TO MENU</button>
        </div>
    </div>
    
    <!-- Victory Screen (Tenchu-style) -->
    <div id="resultScreen" class="overlay-screen hidden">
        <div class="result-scroll">
            <h1>MISSION COMPLETE</h1>
            <div class="rank-text" id="rankLabel">RANK</div>
            <div id="statsTable"></div>
            <button class="reload-btn" onclick="window.location.reload()">NEW MISSION</button>
        </div>
    </div>
    
    <!-- Game Over Screen -->
    <div id="gameOverScreen" class="overlay-screen hidden">
        <div class="result-scroll">
            <h1>MISSION FAILED</h1>
            <div class="fail-text">You have been defeated.<br>Better luck next time!</div>
            <button class="reload-btn" onclick="window.location.reload()">TRY AGAIN</button>
        </div>
    </div>
    
    <script src="core_main.js"></script>
    <script src="core_vfx.js"></script>
    <script src="core_highlight.js"></script>
    <script src="player.js"></script>
    <script src="enemy.js"></script>
    <!-- Menu functionality will be added to core_main.js -->
</body>
</html>